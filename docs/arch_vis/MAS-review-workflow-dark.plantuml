@startuml MAS-review-workflow-dark
' GitHub Dark Theme (Primer)
' Sourced from: https://github.com/primer/github-vscode-theme

skinparam backgroundcolor #0D1117

skinparam actor {
    BackgroundColor #161B22
    BorderColor #8B949E
    FontColor #C9D1D9
}
skinparam participant {
    BackgroundColor #161B22
    BorderColor #8B949E
    FontColor #C9D1D9
}
skinparam database {
    BackgroundColor #161B22
    BorderColor #8B949E
    FontColor #C9D1D9
}
skinparam entity {
    BackgroundColor #161B22
    BorderColor #8B949E
    FontColor #C9D1D9
}
skinparam note {
    BackgroundColor #161B22
    BorderColor #30363D
    FontColor #C9D1D9
}
skinparam sequence {
    ArrowColor #58A6FF
    ArrowFontColor #C9D1D9
    LifeLineBorderColor #8B949E
    GroupBorderColor #30363D
    GroupFontColor #C9D1D9
    GroupHeaderFontColor #C9D1D9
    GroupBackgroundColor #161B22
}
skinparam sequenceActivationBackgroundColor #010409
skinparam sequenceActivationBorderColor #000

actor User

participant "Manager Agent" as Manager
participant "Researcher Agent" as Researcher
database "PeerRead Dataset" as DB
participant "LLM" as LLM
entity "ReviewPersistence" as Persistence

User -> Manager: Request to review paper "X"
activate Manager

Manager -> DB: Get paper content for "X"
activate DB
DB --> Manager: Return paper content
deactivate DB

note right of Manager
  The Manager now loads the
  `review_template.md` and
  fills it with the paper's data.
end note

Manager -> LLM: Generate review using filled template
activate LLM
LLM --> Manager: Return structured review (ReviewGenerationResult)
deactivate LLM

Manager -> Persistence: Save review for paper "X"
activate Persistence
Persistence -> Persistence: Create timestamped JSON file
Persistence --> Manager: Confirm save
deactivate Persistence

Manager --> User: Acknowledge completion

group Optional Delegation
    Manager -> Researcher: Delegate research query
    activate Researcher
    Researcher -> Researcher: Use DuckDuckGo Search
    Researcher --> Manager: Return research results
    deactivate Researcher
end group

deactivate Manager

@enduml
